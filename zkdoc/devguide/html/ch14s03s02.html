<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Configure Connection Pooling</title><link rel="stylesheet" href="devguide.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.0"><link rel="start" href="index.html" title="ZK Developer's Guide"><link rel="up" href="ch14s03.html" title="Use with Connection Pooling"><link rel="prev" href="ch14s03s01.html" title="Connect and Close a Connection"><link rel="next" href="ch14s04.html" title="ZK Features Applicable to Database Access"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Configure Connection Pooling</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch14s03s01.html">Prev</a> </td><th width="60%" align="center">Use with Connection Pooling</th><td width="20%" align="right"> <a accesskey="n" href="ch14s04.html">Next</a></td></tr></table><hr></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a name="id495539"></a>Configure Connection Pooling</h3></div></div></div><p>The configuration of connection pooling varies from one J2EE/Web/Database server to another. Here we illustrated some of them. You have to consult the document of the server you are using.</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a name="id495551"></a>Tomcat 5.5 + MySQL</h4></div></div></div><p>To configure connection pooling for Tomcat 5.5, you have to edit $TOMCAT_DIR/conf/context.xml<sup>[<a name="id495560" href="#ftn.id495560" class="footnote">64</a>]</sup>, and add the following content under the &lt;Context&gt; element. The information that depends on your installation and usually need to be changed is marked in the blue color.</p><pre class="programlisting">&lt;!-- The name you used above, must match _exactly_ here!    The connection pool will be bound into JNDI with the name        "java:/comp/env/jdbc/MyDB"    --&gt;&lt;Resource name="jdbc/MyDB" username="someuser" password="somepass"     url="jdbc:mysql://localhost:3306/test"         auth="Container" defaultAutoCommit="false"         driverClassName="com.mysql.jdbc.Driver" maxActive="20"         timeBetweenEvictionRunsMillis="60000"         type="javax.sql.DataSource" /&gt;    &lt;/ResourceParams&gt;</pre><p>Then, in web.xml, you have to add the following content under the &lt;web-app&gt; element as follows.</p><pre class="programlisting">&lt;resource-ref&gt;&lt;res-ref-name&gt;jdbc/MyDB&lt;/res-ref-name&gt;&lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;&lt;res-auth&gt;Container&lt;/res-auth&gt;&lt;/resource-ref&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a name="id495628"></a>JBoss + MySQL</h4></div></div></div><p>The following instructions is based on section 23.3.4.3 of the reference manual of MySQL 5.0.</p><p>To configure connection pooling for JBoss, you have to add a new file to the directory called deploy ($JBOSS_DIR/server/default/deploy). The file name must end with "-ds.xml", which tells JBoss to deploy this file as JDBC Datasource. The file must have the following contents. The information that depends on your installation and usually need to be changed is marked in the blue color.</p><pre class="programlisting">&lt;datasources&gt;&lt;local-tx-datasource&gt;&lt;!-- This connection pool will be bound into JNDI with the name"java:/MyDB" --&gt;&lt;jndi-name&gt;MyDB&lt;/jndi-name&gt;&lt;connection-url&gt;jdbc:mysql://localhost:3306/test&lt;/connection-url&gt;&lt;driver-class&gt;com.mysql.jdbc.Driver&lt;/driver-class&gt;&lt;user-name&gt;someser&lt;/user-name&gt;&lt;password&gt;somepass&lt;/password&gt;&lt;min-pool-size&gt;5&lt;/min-pool-size&gt;&lt;!-- Don't set this any higher than max_connections on yourMySQL server, usually this should be a 10 or a few 10'sof connections, not hundreds or thousands --&gt;&lt;max-pool-size&gt;20&lt;/max-pool-size&gt;&lt;!-- Don't allow connections to hang out idle too long,never longer than what wait_timeout is set to on theserver...A few minutes is usually okay here,it depends on your applicationand how much spikey load it will see --&gt;&lt;idle-timeout-minutes&gt;5&lt;/idle-timeout-minutes&gt;&lt;!-- If you're using Connector/J 3.1.8 or newer, you can useour implementation of these to increase the robustnessof the connection pool. --&gt;&lt;exception-sorter-class-name&gt;com.mysql.jdbc.integration.jboss.ExtendedMysqlExceptionSorter&lt;/exception-sorter-class-name&gt;&lt;valid-connection-checker-class-name&gt;com.mysql.jdbc.integration.jboss.MysqlValidConnectionChecker&lt;/valid-connection-checker-class-name&gt;&lt;/local-tx-datasource&gt;&lt;/datasources&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a name="id495669"></a>JBoss + PostgreSQL</h4></div></div></div><pre class="programlisting">&lt;datasources&gt;    &lt;local-tx-datasource&gt;        &lt;!-- This connection pool will be bound into JNDI with the name         "java:/MyDB" --&gt;        &lt;jndi-name&gt;MyDB&lt;/jndi-name&gt;                &lt;!-- jdbc:postgresql://[servername]:[port]/[database name] --&gt;        &lt;connection-url&gt;jdbc:postgresql://localhost/test&lt;/connection-url&gt;        &lt;driver-class&gt;org.postgresql.Driver&lt;/driver-class&gt;        &lt;user-name&gt;someuser&lt;/user-name&gt;        &lt;password&gt;somepass&lt;/password&gt;        &lt;min-pool-size&gt;5&lt;/min-pool-size&gt;        &lt;max-pool-size&gt;20&lt;/max-pool-size&gt;        &lt;track-statements&gt;false&lt;/track-statements&gt;        &lt;/local-tx-datasource&gt;    &lt;/datasources&gt;</pre></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.id495560" href="#id495560" class="para">64</a>] </sup>Thanks Thomas Muller (<a class="ulink" href="http://asconet.org:8000/antville/oberinspector" target="_top">http://asconet.org:8000/antville/oberinspector</a>) for correction.</p><p>See also <a class="ulink" href="http://tomcat.apache.org/tomcat-5.5-doc/jndi-resources-howto.html" target="_top">http://tomcat.apache.org/tomcat-5.5-doc/jndi-resources-howto.html</a> and <a class="ulink" href="http://en.wikibooks.org/wiki/ZK/How-Tos/HowToHandleHibernateSessions#Working_with_the_Hibernate_session" target="_top">http://en.wikibooks.org/wiki/ZK/How-Tos/HowToHandleHibernateSessions#Working_with_the_Hibernate_session</a> for more details.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch14s03s01.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch14s03.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch14s04.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Connect and Close a Connection </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> ZK Features Applicable to Database Access</td></tr></table></div></body></html>
