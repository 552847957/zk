<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Initialization Before Processing Each Event</title><link rel="stylesheet" href="devguide.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.0"><link rel="start" href="index.html" title="ZK Developer's Guide"><link rel="up" href="ch05s05.html" title="Initialization and Cleanup of Event Processing Thread"><link rel="prev" href="ch05s05.html" title="Initialization and Cleanup of Event Processing Thread"><link rel="next" href="ch05s05s02.html" title="Cleanup After Processed Each Event"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Initialization Before Processing Each Event</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch05s05.html">Prev</a> </td><th width="60%" align="center">Initialization and Cleanup of Event Processing Thread</th><td width="20%" align="right"> <a accesskey="n" href="ch05s05s02.html">Next</a></td></tr></table><hr></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a name="id473992"></a>Initialization Before Processing Each Event</h3></div></div></div><p>An event listener is executed in an event processing thread. Sometimes, you have to initialize the thread before processing any event.</p><p>A typical example is to initialize the thread for the authentication. Some J2EE or Web containers store authentication information in the thread local storage, such that they could re-authenticate automatically when needed.</p><p>To initialize the event processing threads, you have to register a class, that implements the org.zkoss.zk.ui.event.EventThreadInit interface, to the listener element in the WEB-INF/zk.xml file<sup>[<a name="id474017" href="#ftn.id474017" class="footnote">30</a>]</sup>.</p><p>Once registered, an instance of the specified class is constructed in the main thread (aka., the servlet thread), before starting an event processing thread. Then, the init method of the instance is called at the context of the event processing thread before doing anything else.</p><p>Notice that the constructor and the init method are invoked at different thread such that developers could retrieve thread-dependent data from one thread and pass to anther.</p><p>Here is an example for the authentication mechanism of JBoss<sup>[<a name="id474046" href="#ftn.id474046" class="footnote">31</a>]</sup>. In this example, we retrieve the information stored in the servlet thread in the constructor. Then, we initialize the event processing thread when the init method is called.</p><pre class="programlisting">import java.security.Principal;import org.jboss.security.SecurityAssociation;import org.zkoss.zk.ui.Component;import org.zkoss.zk.ui.event.Event;import org.zkoss.zk.ui.event.EventThreadInit;public class JBossEventThreadInit implements EventThreadInit {    private final Principal _principal;        private final Object _credential;        /** Retrieve info at the constructor, which runs at the servlet thread. */        public JBossEventThreadInit() {            _principal = SecurityAssociation.getPrincipal();                _credential = SecurityAssociation.getCredential();            }        //-- EventThreadInit --//        /** Initial the event processing thread at this method. */        public void init(Component comp, Event evt) {            SecurityAssociation.setPrincipal(_principal);                SecurityAssociation.setCredential(_credential);            }    }</pre><p>Then, in WEB-INF/zk.xml, you have to specify as follows.</p><pre class="programlisting">&lt;zk&gt;    &lt;listener&gt;            &lt;listener-class&gt;JBossEventThreadInit&lt;/listener-class&gt;            &lt;/listener&gt;    &lt;/zk&gt;</pre><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.id474017" href="#id474017" class="para">30</a>] </sup>It is described more detailedly in Appendix B in the Developer's Reference.</p></div><div class="footnote"><p><sup>[<a name="ftn.id474046" href="#id474046" class="para">31</a>] </sup>http://www.jboss.org</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch05s05.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch05s05.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch05s05s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Initialization and Cleanup of Event Processing Thread </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Cleanup After Processed Each Event</td></tr></table></div></body></html>
