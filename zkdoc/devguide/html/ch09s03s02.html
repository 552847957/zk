<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Provide Additional Methods</title><link rel="stylesheet" href="devguide.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.0"><link rel="start" href="index.html" title="ZK Developer's Guide"><link rel="up" href="ch09s03.html" title="Regular Macros"><link rel="prev" href="ch09s03s01.html" title="Macro Components and The ID Space"><link rel="next" href="ch10.html" title="10. Advanced Features"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Provide Additional Methods</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch09s03s01.html">Prev</a> </td><th width="60%" align="center">Regular Macros</th><td width="20%" align="right"> <a accesskey="n" href="ch10.html">Next</a></td></tr></table><hr></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a name="id490741"></a>Provide Additional Methods</h3></div></div></div><p>A macro component implements the org.zkoss.zk.ui.ext.DynamicPropertied interface, so you can access its properties by use of the getDynamicProperty methods as follows.</p><pre class="programlisting">&lt;username id="ua" who="John"/&gt;&lt;button label="what?" onClick="alert(ua.getDynamicProperty(&amp;quot;who&amp;quot;))"/&gt;</pre><p>Obviously, using DynamicPropertied is tedious. Worse of all, the macro's child components won't be changed if you use setDynamicProperty to change a property. For example, the following codes still show John as the username, not Mary.</p><pre class="programlisting">&lt;username id="ua" who="John"/&gt;&lt;zscript&gt;ua.setDynamicProperty("who", "Mary");&lt;/zscript&gt;</pre><p>Why? All child components of a macro component are created when the macro component is created, and they won't be changed unless you manipulate them manually<sup>[<a name="id490785" href="#ftn.id490785" class="footnote">56</a>]</sup>. Thus, the invocation to setDynamicProperty affects only the properties stored in a macro component (which you can retrieve with getDynamicProperties). The content of textbox remains intact.</p><p>Thus, it is better to provide a method, say setWho, to manipulate the macro component directly. To provide your own methods, you have to implement a class for the macro components, and then specify it in the class attribute of the component directive.</p><p>Tip: To recreate child components with the current properties, you can use the recreate method. It actually detaches all child components, and then create them again.</p><p>There are two ways to implement a class. The details are described in the following sections.</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a name="id490820"></a>Provide Additional Methods in Java</h4></div></div></div><p>It takes two steps to provide additional methods for a macro component.</p><p>1. Implement a class by extending from the org.zkoss.zk.ui.HtmlMacroComponent class.</p><pre class="programlisting">//Username.javapackage mypack;public class Username extends HtmlMacroComponent {    public void setWho(String name) {            setDynamicProperty("who", name); //arg.who requires it                final Textbox tb = (Textbox)getFellow("mc_who");                if (tb != null) tb.setValue(name); //correct the child if available            }        public String getWho() {            return (String)getDynamicaProperty("who");            }    }</pre><div class="itemizedlist"><ul type="disc"><li><p>As depicted above, you have to call setDynamicProperty in setWho, because ${arg.who} is referenced in the macro page (${arg.who}), which is used when a macro component are creating its child components.</p></li><li><p>Since the setWho method might be called before a macro component creates its children, you have to check whether mc_who exists.</p></li><li><p>Since mc_who's setValue is called, both the content and the visual presentation at the client are updated automatically, when setWho is called.</p></li></ul></div><div class="orderedlist"><p>2. Declare the class in the macro declaration with the class attribute.</p><ol type="1"></ol></div><pre class="programlisting">&lt;?component name="username" macroURI="/WEB-INF/macros/username.zul"class="mypack.Username"?&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a name="id490902"></a>Provide Additional Methods in zscript</h4></div></div></div><p>In addition to implementing with a Java file, you can implement the Java class(es) in zscript. The advantage is that no compilation is required and you can modify its content dynamically (without re-deploying the Web application). The disadvantage is the performance downgrade and prone to typos. </p><p>It takes a few steps to implement a Java class in zscript.</p><p>1. You have to prepare a zscript file, say /zs/username.zs, for the class to implement. Notice that you can put any number of classes and functions in the same zscript file.</p><pre class="programlisting">//username.zspackage mypack;public class Username extends HtmlMacroComponent {    public void setWho(String name) {            setDynamicProperty("who", name);                Textbox tb = getFellow("mc_who");                if (tb != null) tb.setValue(name);            }        public String getWho() {            return getDynamicProperty("who");            }    }</pre><div class="orderedlist"><p>2. Use the init directive to load the zscript file, and then declare the component</p><ol type="1"></ol></div><pre class="programlisting">&lt;?init zscript="/zs/username.zs"?&gt;&lt;?component name="username" macroURI="/WEB-INF/macros/username.zul"class="mypack.Username"?&gt;</pre><p>The implementation class (mypack.Username in the previous example) is resolved as late as the macro component is really used, so it is also OK to use the zscript element to evaluate the zscript file.</p><pre class="programlisting">&lt;?component name="username" macroURI="/WEB-INF/macros/username.zul"class="mypack.Username"?&gt;&lt;zk&gt;    &lt;zscript src="/zs/username.zs"/&gt;        &lt;username/&gt;    &lt;/zk&gt;</pre><p>Though subjective, the init directive is more readable.</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a name="id490988"></a>Override the Implementation Class When Instantiation</h4></div></div></div><p>Like any other component, you can use the use attribute to override the class used to implement a macro component for any particular instance.</p><pre class="programlisting">&lt;?component name="username" macroURI="/WEB-INF/macros/username.zul"class="mypack.Username?&gt;&lt;username use="another.MyAnotherUsername/&gt;</pre><p>Of course, you have to provide the implementation of another.MyAnohterUsername in the above example. Once again the class can be implemented with separate Java file, or by use of zscript.</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a name="id491016"></a>Create a Macro Component Manually</h4></div></div></div><p>To create a macro component manually, you have to invoke the afterCompose method after all the initialization as follows.</p><pre class="programlisting">HtmlMacroComponent ua = (HtmlMacroComponent)    page.getComponentDefinition("username", false).newInstance(page);    ua.setParent(wnd);ua.applyProperties(); //apply properties defined in the component definitionua.setDynamicProperty("who", "Joe");ua.afterCompose(); //then the ZUML page is loaded and child components are created</pre><p>Note: The getComponentDefinition method is used to look up the component definitions defined in a page.</p><p>If you implement a class, say Username, for the macro, then you can do as follow.</p><pre class="programlisting">Username ua = new Username();ua.setWho("Joe");ua.setParent(wnd);ua.afterCompose();</pre><p></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.id490785" href="#id490785" class="para">56</a>] </sup>On the other hand, the child components included by the include component is created in the rendering phase. In addition, all child components are removed and created each time the include component is invalidated.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch09s03s01.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch09s03.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch10.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Macro Components and The ID Space </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 10. Advanced Features</td></tr></table></div></body></html>
