<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>The Request Interceptor</title><link rel="stylesheet" href="devguide.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.0"><link rel="start" href="index.html" title="ZK Developer's Guide"><link rel="up" href="ch13s01.html" title="Locale"><link rel="prev" href="ch13s01s01.html" title="The px_preferred_locale Session Attribute"><link rel="next" href="ch13s02.html" title="Time Zone"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">The Request Interceptor</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch13s01s01.html">Prev</a> </td><th width="60%" align="center">Locale</th><td width="20%" align="right"> <a accesskey="n" href="ch13s02.html">Next</a></td></tr></table><hr></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a name="id494455"></a>The Request Interceptor</h3></div></div></div><p>Deciding the locale after the user logins may be a bit late for some applications. For example, you might want to use the same Locale that was used in the previous session, before the user logins. For a Web application, it is usually done by use of cookies. With ZK, you can register a request interceptor and manipulates the cookies when the interceptor is called.</p><p>A request interceptor is used to intercept each request processed by ZK Loader and ZK Update Engine. It must implements the org.zkoss.zk.ui.util.RequestInterceptor interface. For example,</p><pre class="programlisting">public class MyLocaleProvider implements org.zkoss.zk.ui.util.RequestInterceptor {    public void request(org.zkoss.zk.ui.Session sess,        Object request, Object response) {            final Cookie[] cookies = ((HttpServletRequest)request).getCookies();                if (cookies != null) {                    for (int j = cookies.length; --j &gt;= 0;) {                            if (cookies[j].getName().equals("my.locale")) {                                    //determine the locale                                        String val = cookies[j].getValue();                                        Locale locale = org.zkoss.util.Locales.getLocale(val);                                        sess.setAttribute(Attributes.PREFERRED_LOCALE, locale);                                        return;                                    }                            }                    }            }    }</pre><p>To make it effective, you have to register it in WEB-INF/zk.xml as follows. Once registered, the request method is called each time ZK Loader or ZK Update Engine receives a request. Refer to Appendix B in the Developer's Reference for more information about configuration.</p><pre class="programlisting">&lt;listener&gt;    &lt;listener-class&gt;MyLocaleProvider&lt;/listener-class&gt;    &lt;/listener&gt;</pre><p>Note: An instance of the interceptor is instantiated when it is registered. It is then shared among all requests in the same application. Thus, you have to make sure it can be accessed concurrently (i.e., thread-safe).</p><p>Note: The request method is called at very early stage, before the request parameters are parsed. Thus, it is recommended to access them in this method, unless you configured the locale and character encoding properly for the request.</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch13s01s01.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch13s01.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch13s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">The px_preferred_locale Session Attribute </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Time Zone</td></tr></table></div></body></html>
