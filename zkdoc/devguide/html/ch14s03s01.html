<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Connect and Close a Connection</title><link rel="stylesheet" href="devguide.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.0"><link rel="start" href="index.html" title="ZK Developer's Guide"><link rel="up" href="ch14s03.html" title="Use with Connection Pooling"><link rel="prev" href="ch14s03.html" title="Use with Connection Pooling"><link rel="next" href="ch14s03s02.html" title="Configure Connection Pooling"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Connect and Close a Connection</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch14s03.html">Prev</a> </td><th width="60%" align="center">Use with Connection Pooling</th><td width="20%" align="right"> <a accesskey="n" href="ch14s03s02.html">Next</a></td></tr></table><hr></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a name="id495409"></a>Connect and Close a Connection</h3></div></div></div><p>After configuring connection pooling (which will be discussed in the following section), you could use JNDI to retrieve an connection as follows.</p><pre class="programlisting">import java.sql.Connection;import java.sql.SQLException;import java.sql.Statement;import javax.naming.InitialContext;import javax.sql.DataSource;import org.zkoss.zul.Window;public class MyWindows extends Window {    private Textbox name, email;        public void onCreate() {            //initial name and email                name = getFellow("name");                email = getFellow("email");            }        public void onOK() throws Exception {    </pre><p>DataSource ds = (DataSource)new InitialContext()</p><p>.lookup("java:comp/env/jdbc/MyDB");</p><pre class="programlisting">//Assumes your database is configured and                        //named as "java:comp/env/jdbc/MyDB"                    Connection conn = null;                Statement stmt = null;                try {        </pre><p>conn = ds.getConnection();</p><pre class="programlisting">stmt = conn.prepareStatement("INSERT INTO user values(?, ?)");            //insert what end user entered into database table                        stmt.set(1, name.value);            </pre><p>stmt.set(2, email.value);</p><pre class="programlisting">            //execute the statement                        stmt.executeUpdate();                        stmt.close(); stmt = null;                            //optional because the finally clause will close it                                //However, it is a good habit to close it as soon as done, especially                                 //you might have to create a lot of statement to complete a job                        } finally { //cleanup                    if (stmt != null) {                            try {                                    stmt.close();                                    } catch (SQLException ex) {                                    //(optional log and) ignore                                    }                            }                        if (conn != null) {                            try {                                    conn.close();                                    } catch (SQLException ex) {                                    //(optional log and) ignore                                    }                            }                    }            }    }</pre><p>Notes:</p><div class="itemizedlist"><ul type="disc"><li><p>It is important to close the statement and connection after use.</p></li><li><p>You could access multiple database at the same time by use of multiple connections. Depending on the configuration and J2EE/Web servers, these connections could even form a distributed transaction.</p></li></ul></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch14s03.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch14s03.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch14s03s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Use with Connection Pooling </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Configure Connection Pooling</td></tr></table></div></body></html>
