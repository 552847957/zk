<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Access Database in EL Expressions</title><link rel="stylesheet" href="devguide.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.0"><link rel="start" href="index.html" title="ZK Developer's Guide"><link rel="up" href="ch14s04.html" title="ZK Features Applicable to Database Access"><link rel="prev" href="ch14s04s01.html" title="The org.zkoss.zk.ui.event.EventThreadCleanup Interface"><link rel="next" href="ch14s04s03.html" title="Transaction and org.zkoss.zk.util.Initiator"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Access Database in EL Expressions</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch14s04s01.html">Prev</a> </td><th width="60%" align="center">ZK Features Applicable to Database Access</th><td width="20%" align="right"> <a accesskey="n" href="ch14s04s03.html">Next</a></td></tr></table><hr></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a name="id495727"></a>Access Database in EL Expressions</h3></div></div></div><p>In additions to access database in an event listener, it is common to access database to fulfill an attribute by use of an EL expression. In the following example, we fetch the data from database and represent them with listbox by use of EL expressions.</p><pre class="programlisting">&lt;zscript&gt;import my.CustomerManager;    customers = new CustomerManager().findAll(); //load from database    &lt;/zscript&gt;&lt;listbox id="personList" width="800px" rows="5"&gt;    &lt;listhead&gt;            &lt;listheader label="Name"/&gt;                &lt;listheader label="Surname"/&gt;                &lt;listheader label="Due Amount"/&gt;            &lt;/listhead&gt;        &lt;listitem value="${each.id}" forEach="${customers}"&gt;            &lt;listcell label="${each.name}"/&gt;                &lt;listcell label="${each.surname}"/&gt;                &lt;listcell label="${each.due}"/&gt;            &lt;/listitem&gt;    &lt;/listbox&gt;</pre><p>There are several way to implement the findAll method.</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a name="id495755"></a>Read all and Copy to a LinkedList</h4></div></div></div><p>The simplest way is to retrieve all data in the findAll method, copy them into a list and then close the connection.</p><pre class="programlisting">public class CustomerManager {    public List findAll() throws Exception {            DataSource ds = (DataSource)new InitialContext()                        .lookup("java:comp/env/jdbc/MyDB");                        Connection conn = null;                Statement stmt = null;                ResultSet rs = null;                List results = new LinkedList();                try {        </pre><p>conn = ds.getConnection();</p><pre class="programlisting">stmt = conn.createStatement();            rs = stmt.executeQuery("SELECT id, name, surname FROM customers");                        while (rs.next()) {                            long id = rs.getInt("id");                                String name = rs.getString("name");                                String surname = rs.getString("surname");                                results.add(new Customer(id, name, surname));                            }            </pre><p>return results;</p><pre class="programlisting">        } finally {                    if (rs != null) try { rs.close(); } catch (SQLException ex) [}                        if (stmt != null) try { stmt.close(); } catch (SQLException ex) [}                        if (conn != null) try { conn.close(); } catch (SQLException ex) [}                    }            }    }</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a name="id495817"></a>Implement the org.zkoss.zk.ui.util.Initiator Interface</h4></div></div></div><p>Instead of mixing Java codes with the view, you could use the init Directive to load the data.</p><pre class="programlisting">&lt;?init class="my.AllCustomerFinder" arg0="customers"?&gt;&lt;listbox id="personList" width="800px" rows="5"&gt;    &lt;listhead&gt;            &lt;listheader label="Name"/&gt;                &lt;listheader label="Surname"/&gt;                &lt;listheader label="Due Amount"/&gt;            &lt;/listhead&gt;        &lt;listitem value="${each.id}" forEach="${customers}"&gt;            &lt;listcell label="${each.name}"/&gt;                &lt;listcell label="${each.surname}"/&gt;                &lt;listcell label="${each.due}"/&gt;            &lt;/listitem&gt;    &lt;/listbox&gt;</pre><p>Then, implement the my.CustomerFindAll class with the org.zkoss.zk.ui.util.Initiator interface.</p><pre class="programlisting">import org.zkoss.zk.ui.Page;import org.zkoss.zk.ui.util.Initiator;public class AllCustomerFinder implements Initiator {    public void doInit(Page page, Object[] args) {            try {                    page.setVariable((String)args[0], new CustomerManager().findAll());                            //Use setVariable to pass the result back to the page                        } catch (Exception ex) {                    throw UiException.Aide.wrap(ex);                    }            }        public void doCatch(Throwable ex) { //ignore        }        public void doFinally() { //ignore        }    }</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch14s04s01.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch14s04.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch14s04s03.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">The org.zkoss.zk.ui.event.EventThreadCleanup Interface </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Transaction and org.zkoss.zk.util.Initiator</td></tr></table></div></body></html>
