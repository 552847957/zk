#!/bin/bash
# release
#
#{{IS_NOTE
#	Purpose:
#		
#	Description:
#		
#	History:
#		Tue Mar 3 11:11:09     2011, Created by Jimmy
#}}IS_NOTE
#
#Copyright (C) 2011 Potix Corporation. All Rights Reserved.
#
#{{IS_RIGHT
#}}IS_RIGHT
#
maindir="$(pwd)"
maindir="${maindir%/cmldoc}"
cd $maindir
echo "Working directory $maindir"
stamp=$(date +%Y%m%d)
oldVersion=$1
newVersion=$2

if [ "$oldVersion" == "" ] || [ "$newVersion" == "" ] ; then
	echo "Usage: upVer [ oldVersion ] [ newVersion ]"
	exit 1
fi

function upVer {
	sed -i "1,/version>.*<\/version/s/version>.*<\/version/version>$newVersion<\/version/" $maindir/$1/pom.xml
	sed -i "s/$oldVersion/$newVersion/g" $maindir/$1/version
	find $maindir/$1/src -name MANIFEST.MF -exec sed -i "s/$oldVersion/$newVersion/g" {} \;
	find $maindir/$1/src -name config.xml -exec sed -i "s/$oldVersion/$newVersion/g" {} \;
	find $maindir/$1/src -name lang.xml -exec sed -i "s/$oldVersion/$newVersion/g" {} \;
	find $maindir/$1/src -name lang-addon.xml -exec sed -i "s/$oldVersion/$newVersion/g" {} \;
	find $maindir/$1/src -name Version.java -exec sed -i "s/$oldVersion/$newVersion/g" {} \;
}

sed -i "s/$oldVersion-FL/$oldVersion/g" $maindir/build.setting
sed -i "s/$oldVersion/$newVersion-FL/g" $maindir/build.setting
upVer zk
find $maindir/zk/src -name Version.java -exec sed -i "s/$newVersion/$newVersion/g" {} \;
upVer zksandbox
upVer zktest
upVer zkplus
upVer zul
upVer zweb
upVer zkex
upVer zkmax
upVer zml